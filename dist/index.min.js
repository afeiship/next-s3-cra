/*!
 * name: @jswork/next-s3-helper
 * description: Aws s3 helper for next.
 * homepage: https://github.com/afeiship/next-s3-helper
 * version: 1.0.1
 * date: 2020-11-30 13:47:15
 * license: MIT
 */
!function(){var u=(this||window||Function("return this")()).nx||require("@jswork/next"),n=require("@jswork/next-path-parse"),t=require("aws-sdk"),i=require("globby"),s=require("mime"),o=require("fs"),c=require("path"),e=u.declare("nx.S3Helper",{methods:{init:function(e){this.s3=new t.S3(e)},list:function(e){return this.s3.listObjects(e).promise()},dels:function(i){var s=this;return new Promise(function(r,n){s.s3.listObjects({Bucket:i.Bucket,Prefix:i.Prefix}).promise().then(function(e){delete i.Prefix;var t=e.Contents.map(function(e){return{Key:e.Key}});if(!t.length)return r(e);t=u.mix({Delete:{Objects:t,Quiet:!0}},i);return s.s3.deleteObjects(t).promise().then(r).catch(n)}).catch(n)})},puts:function(e,t){var r=this,e=i.sync(e,u.mix({absolute:!0},t.globby)).map(function(e){e=n(e,{cwd:process.cwd(),context:t.context.local});return r.s3.putObject({ACL:t.ACL||"public-read",Bucket:t.Bucket,Key:c.join(t.context.remote,e.relative),Body:o.readFileSync(e.full),ContentType:s.getType(e.full)}).promise()});return Promise.all(e)}}});"undefined"!=typeof module&&module.exports&&(module.exports=e)}();