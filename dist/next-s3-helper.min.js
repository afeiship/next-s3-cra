/*!
 * name: @feizheng/next-s3-helper
 * description: Aws s3 helper for next.
 * homepage: https://github.com/afeiship/next-s3-helper
 * version: 1.0.0
 * date: 2020-11-02T10:29:00.512Z
 * license: MIT
 */
!function(){var s=(this||window||Function("return this")()).nx||require("@feizheng/next-js-core2"),i=require("@feizheng/next-path-parse"),t=require("aws-sdk"),o=require("globby"),u=require("mime"),c=require("fs"),l=require("path"),e=s.declare("nx.S3Helper",{methods:{init:function(e){this.s3=new t.S3(e)},list:function(e){return this.s3.listObjects(e).promise()},del:function(o){var u=this;return new Promise(function(n,i){u.s3.listObjects({Bucket:o.Bucket,Prefix:o.Prefix}).promise().then(function(e){delete o.Prefix;var t=e.Contents.map(function(e){return{Key:e.Key}}),r=s.mix({Delete:{Objects:t,Quiet:!0}},o);return u.s3.deleteObjects(r).promise().then(n).catch(i)}).catch(i)})},upload:function(e,r){var n=this,t=o.sync(e,s.mix({absolute:!0},r.globby)).map(function(e){var t=i(e,{cwd:process.cwd(),context:r.context.local});return n.s3.putObject({ACL:r.ACL||"public-read",Bucket:r.Bucket,Key:l.join(r.context.remote,t.relative),Body:c.readFileSync(t.full),ContentType:u.getType(t.full)}).promise()});return Promise.all(t)}}});"undefined"!=typeof module&&module.exports&&(module.exports=e)}();